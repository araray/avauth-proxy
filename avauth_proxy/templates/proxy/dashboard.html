{% extends "base.html" %} {% block content %}
<h1>Proxy Management Dashboard</h1>

<h2>Current Proxies</h2>
<table>
    <thead>
        <tr>
            <th>Service Name</th>
            <th>URL/IP</th>
            <th>Port</th>
            <th>Template</th>
            <th>Health Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for proxy in proxies %}
        <tr>
            <td>{{ proxy.service_name }}</td>
            <td>{{ proxy.url }}</td>
            <td>{{ proxy.port }}</td>
            <td>{{ proxy.template }}</td>
            <td>
                <span class="health-status-icon {{ proxy.health_status }}">
                    {{ proxy.health_status }}
                </span>
            </td>
            <td>
                <form
                    method="post"
                    action="{{ url_for('proxy.remove_proxy') }}"
                >
                    <input
                        type="hidden"
                        name="service_name"
                        value="{{ proxy.service_name }}"
                    />
                    <button type="submit">Remove</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<button onclick="runHealthChecks()">Run Health Checks</button>

<script>
    async function runHealthChecks() {
        const response = await fetch("/metrics/healthcheck", {
            method: "POST",
        });
        if (response.ok) {
            location.reload();
        } else {
            alert("Health check failed.");
        }
    }
</script>
{% endblock %}
