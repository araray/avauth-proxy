{% extends "base.html" %} {% block content %}
<h1>Log Viewer</h1>
<select id="log-type">
    <option value="nginx">Nginx Logs</option>
    <option value="app">Application Logs</option>
</select>
<button onclick="fetchLogs()">View Logs</button>
<button onclick="exportLogs('json')">Export as JSON</button>
<button onclick="exportLogs('csv')">Export as CSV</button>

<div
    id="log-viewer"
    style="
        white-space: pre;
        margin-top: 20px;
        border: 1px solid #ccc;
        padding: 10px;
        height: 300px;
        overflow-y: scroll;
    "
></div>
<select id="rows-per-page" onchange="updateRowsPerPage()">
    <option value="5">5</option>
    <option value="10" selected>10</option>
    <option value="20">20</option>
</select>
<script>
    async function fetchLogs() {
        const logType = document.getElementById("log-type").value;
        const response = await fetch(`/logs/${logType}`);
        if (response.ok) {
            const data = await response.json();
            document.getElementById("log-viewer").innerText =
                data.logs.join("");
        } else {
            document.getElementById("log-viewer").innerText =
                "Error loading logs.";
        }
    }
</script>
<script>
    async function exportLogs(format) {
        const logType = document.getElementById("log-type").value;
        const response = await fetch(`/logs/${logType}`);
        const logs = await response.json();
        const blob = new Blob([JSON.stringify(logs, null, 2)], {
            type: "application/json",
        });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `logs.${format}`;
        link.click();
    }
</script>
{% endblock %}
